<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JaxRsFailureHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ms-engine-spring-jaxrs</a> &gt; <a href="index.source.html" class="el_package">net.trajano.ms.engine.jaxrs</a> &gt; <span class="el_source">JaxRsFailureHandler.java</span></div><h1>JaxRsFailureHandler.java</h1><pre class="source lang-java linenums">package net.trajano.ms.engine.jaxrs;

import javax.ws.rs.ClientErrorException;
import javax.ws.rs.WebApplicationException;
import javax.ws.rs.core.HttpHeaders;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response.Status;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import io.vertx.core.Handler;
import io.vertx.core.http.HttpMethod;
import io.vertx.ext.web.RoutingContext;
import org.springframework.stereotype.Component;

@Component
<span class="nc" id="L18">public class JaxRsFailureHandler implements</span>
    Handler&lt;RoutingContext&gt; {

<span class="nc" id="L21">    private static final Logger LOG = LoggerFactory.getLogger(JaxRsFailureHandler.class);</span>

    private static void sendErrorResponse(final RoutingContext context,
        final WebApplicationException webAppException) {

<span class="nc" id="L26">        context.response().setStatusCode(webAppException.getResponse().getStatus());</span>
<span class="nc" id="L27">        context.response().setStatusMessage(webAppException.getResponse().getStatusInfo().getReasonPhrase());</span>
<span class="nc bnc" id="L28" title="All 2 branches missed.">        if (context.request().method() != HttpMethod.HEAD) {</span>
<span class="nc bnc" id="L29" title="All 2 branches missed.">            if (webAppException.getResponse().getMediaType() == null) {</span>
<span class="nc" id="L30">                context.response().putHeader(HttpHeaders.CONTENT_TYPE, MediaType.TEXT_PLAIN);</span>
            } else {
<span class="nc" id="L32">                context.response().putHeader(HttpHeaders.CONTENT_TYPE, webAppException.getResponse().getMediaType().toString());</span>
            }
<span class="nc" id="L34">            context.response().end(webAppException.getResponse().getStatusInfo().getReasonPhrase());</span>
        }
<span class="nc" id="L36">    }</span>

    @Override
    public void handle(final RoutingContext context) {

<span class="nc" id="L41">        final Throwable wae = context.failure();</span>
<span class="nc bnc" id="L42" title="All 2 branches missed.">        if (wae instanceof ClientErrorException) {</span>
            // Use a lower level of logging when it is a client error exception
<span class="nc" id="L44">            final WebApplicationException webAppException = (WebApplicationException) wae;</span>
<span class="nc" id="L45">            LOG.debug(wae.getMessage(), wae);</span>
<span class="nc" id="L46">            sendErrorResponse(context, webAppException);</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">        } else if (wae instanceof WebApplicationException) {</span>
<span class="nc" id="L48">            final WebApplicationException webAppException = (WebApplicationException) wae;</span>
<span class="nc" id="L49">            LOG.error(wae.getMessage(), wae);</span>
<span class="nc" id="L50">            sendErrorResponse(context, webAppException);</span>
<span class="nc" id="L51">        } else {</span>
<span class="nc" id="L52">            LOG.error(wae.getMessage(), wae);</span>
<span class="nc" id="L53">            context.response().setStatusCode(500);</span>
<span class="nc" id="L54">            context.response().setStatusMessage(Status.INTERNAL_SERVER_ERROR.getReasonPhrase());</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">            if (context.request().method() != HttpMethod.HEAD) {</span>
<span class="nc" id="L56">                context.response().putHeader(HttpHeaders.CONTENT_TYPE, MediaType.TEXT_PLAIN);</span>
<span class="nc" id="L57">                context.response().end(Status.INTERNAL_SERVER_ERROR.getReasonPhrase());</span>
            }
        }

<span class="nc" id="L61">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>